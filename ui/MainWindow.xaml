<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ReqMultiServ"
        Width="1230"
        Height="800"
        WindowStartupLocation="CenterScreen">

    <Grid>
        <!-- ================= LAYOUT GLOBAL ================= -->
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>    <!-- Main content -->
            <RowDefinition Height="5"/>    <!-- HSplit -->
            <RowDefinition Height="*"/>    <!-- Results -->
            <RowDefinition Height="Auto"/> <!-- Status bar -->
        </Grid.RowDefinitions>

        <!-- ================= MAIN ================= -->
        <Grid Grid.Row="0" Margin="10,10,10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320" /> <!-- Left -->
                <ColumnDefinition Width="5" />   <!-- VSplit -->
                <ColumnDefinition Width="*" />   <!-- Center -->
                <ColumnDefinition Width="5" />   <!-- VSplit -->
                <ColumnDefinition Width="320" /> <!-- Right -->
            </Grid.ColumnDefinitions>

            <!-- ================= LEFT COLUMN ================= -->
            <Grid Grid.Row="0" Grid.Column="0" Margin="0">
                <!-- ================= EXECUTION ================= -->
                <Border Grid.Row="1"
                        BorderBrush="#D0D0D0"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="6"
                        Margin="0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/> <!-- Header -->
                            <RowDefinition Height="*"/> <!-- Execution grid -->
                        </Grid.RowDefinitions>

                        <Grid Grid.Row="0" Margin="6,0,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" /> <!-- Title -->
                                <ColumnDefinition Width="Auto" /> <!-- Toolbar -->
                            </Grid.ColumnDefinitions>

                            <!-- Title (left) -->
                            <TextBlock Text="Execution"
                                    FontWeight="SemiBold"
                                    Foreground="#666"
                                    VerticalAlignment="Center"/>
                            <!-- Buttons (right) -->
                            <Grid Grid.Column="1" >
                                <DockPanel>
                                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" >
                                        <Button x:Name="RunButton"
                                                Content="Run"
                                                Width="50"
                                                Padding="10,3"
                                                Margin="0,0,8,0">
                                            <Button.ToolTip>
                                                <ToolTip Content="Execute SQL on selected servers"/>
                                            </Button.ToolTip>
                                        </Button>

                                        <Button x:Name="KillButton"
                                                Content="Kill"
                                                Width="50"
                                                Padding="10,3"
                                                Margin="0,0,8,0">
                                            <Button.ToolTip>
                                                <ToolTip Content="Stop all running queries (Send KILL request)"/>
                                            </Button.ToolTip>
                                        </Button>

                                        <Button x:Name="ExportButton"
                                                Content="Export"
                                                Width="50"
                                                Padding="6,3"
                                                >
                                            <Button.ToolTip>
                                                <ToolTip Content="Export CSV to Desktop"/>
                                            </Button.ToolTip>
                                        </Button>
                                    </StackPanel>
                                </DockPanel>
                            </Grid>
                        </Grid>

                        <DataGrid x:Name="ExecutionGrid"
                                Grid.Row="1"
                                SelectionUnit="CellOrRowHeader"
                                SelectionMode="Extended"
                                AutoGenerateColumns="False"
                                ClipboardCopyMode="IncludeHeader"
                                IsReadOnly="True"
                                CanUserAddRows="False"
                                CanUserDeleteRows="False"
                                AlternatingRowBackground="#EDF3FD"
                                AlternationCount="2"
                                GridLinesVisibility="All"
                                HorizontalGridLinesBrush="#FFFFFF"
                                VerticalGridLinesBrush="#FFFFFF">
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Kill worker"
                                            x:Name="KillWorkerMenuItem" />
                                </ContextMenu>
                            </DataGrid.ContextMenu>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Server" Binding="{Binding Server.Name}" Width="auto"/>
                                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="auto">
                                    <DataGridTextColumn.CellStyle>
                                        <Style TargetType="DataGridCell">
                                            <Setter Property="Foreground" Value="Gray"/>

                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="done">
                                                    <Setter Property="Foreground" Value="Green"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Status}" Value="error">
                                                    <Setter Property="Foreground" Value="Red"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Status}" Value="killed">
                                                    <Setter Property="Foreground" Value="DarkRed"/>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding Status}" Value="running">
                                                    <Setter Property="Foreground" Value="DarkOrange"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGridTextColumn.CellStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Duration (s)" Binding="{Binding DurationSec, Mode=OneWay, StringFormat={}{0:0.000}}" Width="auto"/>
                                <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
            </Grid>

            <!-- ================= VSPLIT ================= -->
            <GridSplitter Grid.Column="1"
                Grid.Row="0"
                Width="5"
                Background="White"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                ShowsPreview="True"/>

            <!-- ================= SQL BLOCK ================= -->
            <Border Grid.Column="2"
                    BorderBrush="#B5C7E3"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="6"
                    Background="#F9FBFF"
                    Margin="0">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Header -->
                        <RowDefinition Height="*"/> <!-- SQL Textbox -->
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Margin="6,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" /> <!-- Title -->
                            <ColumnDefinition Width="Auto" /> <!-- Limit Combobox -->
                        </Grid.ColumnDefinitions>

                        <!-- Title (left) -->
                        <TextBlock Text="SQL"
                                FontWeight="SemiBold"
                                Foreground="#2B579A"
                                VerticalAlignment="Center"/>

                        <!-- LIMIT Combobox (right) -->
                        <Grid Grid.Column="1"
                            MinWidth="175"
                            HorizontalAlignment="Right">

                            <ComboBox x:Name="LimitComboBox"
                                    Height="24"
                                    MinWidth="175"
                                    Padding="6,0,6,0"
                                    VerticalContentAlignment="Center"
                                    ToolTip="Limits results.">
                            </ComboBox>

                            <!-- Placeholder -->
                            <TextBlock Text="Max rows"
                                    Margin="10,0,0,0"
                                    VerticalAlignment="Center"
                                    Foreground="#888"
                                    IsHitTestVisible="False"
                                    Opacity="0.85">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedItem, ElementName=LimitComboBox}"
                                                        Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                        </Grid>
                    </Grid>

                    <!-- SQL Editor -->
                    <TextBox x:Name="SqlTextBox"
                                Grid.Row="1"
                                AcceptsReturn="True"
                                AcceptsTab="True"
                                VerticalScrollBarVisibility="Auto"
                                HorizontalScrollBarVisibility="Auto"
                                TextWrapping="NoWrap"
                                FontFamily="Consolas"
                                FontSize="13"
                                Padding="6"
                                BorderBrush="#A0A0A0"
                                BorderThickness="1"/>
                </Grid>
            </Border>
        
            <!-- ================= VSPLIT ================= -->
            <GridSplitter Grid.Column="3"
                Grid.Row="0"
                Width="5"
                Background="White"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                ShowsPreview="True"/>

            <!-- ================= RIGHT COLUMN : SERVERS ================= -->
            <Border Grid.Column="4"
                    BorderBrush="#D0D0D0"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="6"
                    Margin="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Header -->
                        <RowDefinition Height="*"/> <!-- Servers -->
                    </Grid.RowDefinitions>

                    <!-- Title (left) -->
                    <TextBlock Text="Servers"
                            FontWeight="SemiBold"
                            Foreground="#666"
                            Margin="0,0,0,6"
                            VerticalAlignment="Center"
                            Grid.Row="0" />

                    <!-- Servers grid -->
                    <DataGrid x:Name="ServersGrid"
                            Grid.Row="1"
                            AutoGenerateColumns="False"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            ClipboardCopyMode="IncludeHeader"
                            IsReadOnly="True"
                            SelectionMode="Extended"
                            SelectionUnit="CellOrRowHeader"
                            AlternatingRowBackground="#EDF3FD"
                            AlternationCount="2"
                            GridLinesVisibility="All"
                            HorizontalGridLinesBrush="#FFFFFF"
                            VerticalGridLinesBrush="#FFFFFF">

                        <DataGrid.Columns>
                            <DataGridTemplateColumn Width="auto" ClipboardContentBinding="{x:Null}">
                                <DataGridTemplateColumn.Header>
                                    <CheckBox x:Name="SelectAllCheckBox"
                                            IsThreeState="True"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                                </DataGridTemplateColumn.Header>

                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Focusable="False"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" />
                            <DataGridTextColumn Header="Host" Binding="{Binding DbHost}" />
                            <DataGridTextColumn Header="Port" Binding="{Binding Port}" />
                            <DataGridTextColumn Header="Database" Binding="{Binding Database}" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
        </Grid>

        <!-- ================= HSPLIT ================= -->
        <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" ShowsPreview="True" Background="White" />

        <Grid Grid.Row="2" Margin="8,0,8,0">
            <!-- ================= RESULTS ================= -->
            <Border Grid.Row="1"
                    BorderBrush="#D0D0D0"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="6"
                    Margin="0,0,0,6">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/> <!-- Header -->
                        <RowDefinition Height="*"/> <!-- Results grid -->
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Margin="6,0,0,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" /> <!-- Title -->
                            <ColumnDefinition Width="Auto" /> <!-- Filter -->
                        </Grid.ColumnDefinitions>

                        <!-- Title (left) -->
                        <TextBlock Text="Results"
                                FontWeight="SemiBold"
                                Foreground="#666"
                                VerticalAlignment="Center"/>

                        <!-- Filter textbox (right) -->
                        <Grid Grid.Column="1"
                            MinWidth="220"
                            HorizontalAlignment="Right">

                            <TextBox x:Name="FilterBox"
                                    Grid.Row="0"
                                    Padding="6,3,6,0"
                                    Width="220"
                                    Height="24"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Text="" />
                            <TextBlock Text="Filter..."
                                    Margin="10,0,0,0"
                                    VerticalAlignment="Center"
                                    IsHitTestVisible="False"
                                    Opacity="0.55">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Text, ElementName=FilterBox}" Value="">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                    </Grid>

                    <DataGrid x:Name="ResultsGrid"
                            Grid.Row="1"
                            AutoGenerateColumns="True"
                            IsReadOnly="True"
                            ClipboardCopyMode="IncludeHeader"
                            SelectionUnit="CellOrRowHeader"
                            SelectionMode="Extended"
                            CanUserAddRows="False"
                            CanUserDeleteRows="False"
                            CanUserResizeColumns="True"
                            CanUserResizeRows="True"
                            CanUserSortColumns="True"
                            AlternatingRowBackground="#EDF3FD"
                            AlternationCount="2"
                            GridLinesVisibility="All"
                            HorizontalGridLinesBrush="#FFFFFF"
                            VerticalGridLinesBrush="#FFFFFF">
                    </DataGrid>
                </Grid>
            </Border>
        </Grid>

        <!-- ================= STATUS BAR ================= -->
        <StatusBar Grid.Row="3"
           Height="28"
           Background="#F2F2F2"
           BorderBrush="#CFCFCF"
           BorderThickness="1,0,0,0"
           HorizontalContentAlignment="Stretch">
            <StatusBarItem BorderThickness="0"
                        HorizontalContentAlignment="Stretch"
                        Width="{Binding RelativeSource={RelativeSource AncestorType=StatusBar}, Path=ActualWidth}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- left -->
                    <TextBlock x:Name="StatusText"
                            Grid.Column="0"
                            Padding="8,0,8,0"
                            Text="Ready"
                            Foreground="#555"
                            VerticalAlignment="Center"
                            />

                    <!-- separator -->
                    <Border Grid.Column="1"
                            Width="1"
                            Background="#D6D6D6"/>

                    <!-- right -->
                    <TextBlock x:Name="TimerStatusText"
                            Grid.Column="2"
                            Padding="8,0,8,0"
                            Text="00:00:00"
                            Foreground="#666"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Right"/>
                </Grid>

            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
